plugins {
  id 'idea'
  id "org.jetbrains.gradle.plugin.idea-ext" version "1.1.8"
}

idea {
  module {
    settings {
      rootModuleType = 'PYTHON_MODULE'
    }
    sourceDirs += file('src/main')
    sourceDirs += file('src/demo')
    testSourceDirs += file('src/test')
    excludeDirs += file('.idea')
    excludeDirs += file('.gradle')
    excludeDirs += file('.vscode')
    excludeDirs += file('.gradle')
    excludeDirs += file('.run')
    excludeDirs += file('run-configs')
    excludeDirs += file('src/main/build')
    excludeDirs += file('src/main/dist')
    excludeDirs += file('src/main/hspylib_askai.egg-info')
  }
}

configurations {
    src
}

ext {
  python = "python" + (System.getenv('PYTHON_VERSION') ?: '3')
  pyrcc = "pyrcc" + (System.getenv('PYRCC_VERSION') ?: '5')
  sourceRoot = "${rootDir}/src"
  gradleDir = "${rootDir}/gradle/"
  application = "${sourceRoot}/main/python/__main__.py"
  pythonPath = "${sourceRoot}/main/python/:${sourceRoot}/test/python/:${sourceRoot}/demo/python/"
  buildToolsFile = file("${project.projectDir}/buildTools.txt")
  startTime = System.currentTimeMillis()
  verbose = findProperty('verbose') ?: false
}

apply from: "${rootDir}/src/main/groovy/dependencies.gradle"
apply from: "${rootDir}/src/main/groovy/python.gradle"
apply from: "${rootDir}/src/main/groovy/versioning.gradle"
apply from: "${rootDir}/src/main/groovy/pypi-publish.gradle"
apply from: "${rootDir}/src/main/groovy/docker.gradle"
apply from: "${rootDir}/src/main/groovy/oracle.gradle"
apply from: "${rootDir}/src/main/groovy/docgen.gradle"
apply from: "${rootDir}/src/main/groovy/idea.gradle"
apply from: "${rootDir}/src/main/groovy/devel/poetry.gradle"

/* Download and extract the gradle project ZIP */
tasks.register('pyGradleUpdate') {
  group = 'build'
  description = 'Download and extract the py-gradle project ZIP'
  doLast {
    def outFile = "${gradleDir}/py-gradle.zip"
    def url = "https://github.com/yorevs/py-gradle/archive/master.zip"
    println "Downloading the py-gradle project"
    println "  From: ${url}"
    println "  Into: ${outFile}"
    delete {
      delete file("${gradleDir}")
    }
    mkdir gradleDir
    exec {
      commandLine 'curl', '-L', '-o', "${outFile}", url
    }
    copy {
      from zipTree("${outFile}")
      into "${gradleDir}"
    }
    copy {
      from "${gradleDir}/py-gradle-master"
      into "${gradleDir}"
    }
    delete fileTree(gradleDir).matching {
      include "README*"
      include "LICENSE*"
      include "py-gradle*"
    }
    delete "${gradleDir}/py-gradle-master"
  }
}
